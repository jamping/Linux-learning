1)  yum -y install syslinux xinetd tftp-server dhcp

mkdir /var/lib/tftpboot/pxelinux.cfg
cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ 

ip addr

vi /etc/sysconfig/dhcpd

DHCPDARGS=eth0

2) vi /etc/dhcp/dhcpd.conf

# dhcpd.conf
#
allow booting;
allow bootp;
option option-128 code 128 = string;
option option-129 code 129 = text;
filename "pxelinux.0";
next-server 192.168.0.117;
ddns-update-style none;
option domain-name "zzb.hj";
option domain-name-servers 192.168.0.117;
default-lease-time 600;
max-lease-time 7200;

subnet 192.168.0.0 netmask 255.255.255.0 {
        range 192.168.0.150 192.168.0.200;
        option domain-name-servers hzdns.zzb.hj;
        option domain-name "zzb.hj";
        option routers 192.168.0.1;
        option broadcast-address 192.168.0.255;
        default-lease-time 600;
        max-lease-time 7200;
        filename "pxelinux.0";
        next-server 192.168.0.117;

        host testclient {
                hardware ethernet 08:00:27:9D:9E:A9;
                fixed-address 192.168.0.188;
                filename "pxelinux.0";
                next-server 192.168.0.117;
        }
}

systemctl start xinetd
systemctl enable xinetd 
systemctl restart dhcpd 

3) Download ISO image first to your PXE server. The following example shows the ISO image of CentOS 7 is under /home/iso directory. 

mkdir -p /var/pxe/centos7
mkdir /var/lib/tftpboot/centos7
mount -t iso9660 -o loop /home/jjp/Downloads/CentOS-7-x86_64-DVD-1503-01.iso /var/pxe/centos7
cp /var/pxe/centos7/images/pxeboot/vmlinuz /var/lib/tftpboot/centos7/
cp /var/pxe/centos7/images/pxeboot/initrd.img /var/lib/tftpboot/centos7/
cp /usr/share/syslinux/menu.c32 /var/lib/tftpboot/

vi /var/lib/tftpboot/pxelinux.cfg/default

# create new

timeout 100
default menu.c32

menu title ########## PXE Boot Menu ##########
label 1
   menu label ^1) Install CentOS 7
   kernel centos7/vmlinuz
   append initrd=centos7/initrd.img method=http://192.168.0.117/centos7 devfs=nomount

label 2
   menu label ^2) Boot from local drive
   localboot

4) Start HTTP Server. Refer to here to install httpd. Furthermore add settings like follows.

vi /etc/httpd/conf.d/pxeboot.conf

# create new

Alias /centos7 /var/pxe/centos7
<Directory /var/pxe/centos7>
    Options Indexes FollowSymLinks
    # IP address you allow to access

    Require ip 127.0.0.1 192.168.0.0/24
</Directory>

systemctl restart httpd 

6 ) PXE-E32:TFTP OPen timeout

firewall-cmd --add-service={tftp,dhcp} --permanent
firewall-cmd --reload


7) cobbler

a) yum -y install cobbler cobbler-web dhcp tftp-server pykickstart httpd

b) cobbler语法检查前先启动http与cobbler

systemctl start httpd
systemctl start cobblerd

cobbler check

The following are potential configuration items that you may want to fix:

1 : The 'server' field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP for the boot server as reachable by all machines that will use it.
2 : For PXE to be functional, the 'next_server' field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network.
3 : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run 'cobbler get-loaders' to download them, or, if you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely.  Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The 'cobbler get-loaders' command is the easiest way to resolve these requirements.
4 : enable and start rsyncd.service with systemctl
5 : debmirror package is not installed, it will be required to manage debian deployments and repositories
6 : The default password used by the sample templates for newly installed machines (default_password_crypted in /etc/cobbler/settings) is still set to 'cobbler' and should be changed, try: "openssl passwd -1 -salt 'random-phrase-here' 'your-password-here'" to generate new one
7 : fencing tools were not found, and are required to use the (optional) power management features. install cman or fence-agents to use them

Restart cobblerd and then run 'cobbler sync' to apply changes.

sed -i 's/server: 127.0.0.1/server: 192.168.0.117/' /etc/cobbler/settings
sed -i 's/next_server: 127.0.0.1/next_server: 192.168.0.117/' /etc/cobbler/settings
sed -i 's/manage_dhcp: 0/manage_dhcp: 1/' /etc/cobbler/settings
sed -i 's/pxe_just_once: 0/pxe_just_once: 1/' /etc/cobbler/settings
sed -ri "/default_password_crypted/s#(.*: ).*#\1\"`openssl passwd -1 -salt 'jamping' 'wbgsnmm'`\"#" /etc/cobbler/settings
sed -i 's#yes#no#' /etc/xinetd.d/tftp
sed -i.ori 's#192.168.1#192.168.0#g;22d;23d' /etc/cobbler/dhcp.template

如果当前节点可以访问互联网，执行“cobbler get-loaders”命令亦可,或安装syslinux程序包，再复制/usr/share/syslinux/{pxelinux.0,menu.c32}等文件至/var/lib/cobbler/loaders/目录中,由于本次已经安装好了syslinux,直接从syslinux中复制boot-loaders

cp /usr/share/syslinux/{pxelinux.0,menu.c32} /var/lib/cobbler/loaders/

yum install -y debmirror cman fence-agents 

systemctl start rsyncd
systemctl enable rsyncd
systemctl enable tftp.socket
systemctl start tftp.socket
systemctl restart cobblerd

重启所有服务

systemctl restart httpd
systemctl restart cobblerd
systemctl restart dhcpd
systemctl restart rsyncd
systemctl restart tftp.socket

cobbler sync

htdigest /etc/cobbler/users.digest "Cobbler" cobbler

cobbler import --name=Centos7 --arch=x86_64 --path=/mnt/centos7

cobbler distro list
修改profile指定新的KS启动文件在第一次导入系统镜像时，cobbler会给安装镜像指定一个默认的kickstart自动安装文件，
文件位于/var/lib/cobbler/kickstarts/sample.ks

cobbler profile list ##查看profile列表
cobbler distro report --name=Centos7-x86_64
cobbler system add --name=test --profile=Centos7-x86_64
cobbler system list

